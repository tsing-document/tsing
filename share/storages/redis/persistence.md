# 持久化

- 概要：
    - 定义：
        - Redis 是内存数据库，如果不能将内存中的数据状态保存到磁盘中，那么一旦服务器进程退出，服务器的数据库状态也会消失，所以Redis提供了持久化的功能。
    - 分类：
        - RDB：
            - 定义：
                - 在指定的时间间隔内将内存中的数据集快照写入磁盘中，它恢复的时候是将快照中的文件直接读取到内存中。
                - Redis会单独创建一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行io操作的。这就确保了极高的性能。如果需要进行大规模的数据恢复，且对数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加高效。RDB的缺点是最后一次持久化后的数据可能丢失。
            - 触发机制：
                - 以下三个触发机制触发后都会产生一个rdb文件名结尾的文件。
                    - save规则满足的情况下，会自动触发rdb规则。
                    - 执行flshall命令，也会触发我们的rdb规则。
                    - 退出redis，也会产生一个rdb文件。
            - 恢复数据机制：
                - 只需要将rdb文件放在我们redis启动目录就可以了，redis启动的时候会自动检查文件并恢复其中的数据。
            - 优点：
                - 适合大规模的数据恢复！如果对数据完整性不高！
            - 缺点：
                - 需要一定的时间的间隔进程操作！如果redis意外宕机了，这个最后一次修改的数据就没有了。
                - fork进程的时候，会占用一定的内容空间。
        - AOF：
            - 定义：
                - 将所有的命令都记录下来，恢复的时候就会把这个文件全部执行一遍。
                - 以日志的形式来记录每个写操作，将Redis执行过的所有指令记录下来（读操作不记录），只许追加文件但不可以改写文件，Redis启动之初会读取该文件重新构建数据，换言之，Redis重启的话就会根据日志文件的内容将写的指令从前到后执行一次以完成数据的恢复工作。
            - 问题：
                - 如果 aof 文件被破坏，redis服务是启动不了的。redis本身提供了修复了工具。redis-check-aof --fix appendonly.aof
            - 优点：
                - 每次修改都同步数据，这样就能保证数据的完整性。
                - 每秒中同步数据，这样就会丢失一秒的数据。
                - 从不同步，效率最高。
            - 缺点：
                - 相对数据文件来说，aof远远大于rdb，修复的数据也比rdb慢。
                - aof运行效率也比rdb慢，所以redis默认的配置就是rdb.
- 语法：
- 案例：
